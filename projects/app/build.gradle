plugins {
    id 'java-library'
    id 'application'
    id 'eclipse'
    id 'com.google.cloud.tools.jib' version '3.2.1'
}

description "HoloDB standalone app"

ext.mainClass = 'hu.webarticum.holodb.app.launch.HolodbServerMain'

sourceSets {
    lab {
        compileClasspath += sourceSets.main.runtimeClasspath
        runtimeClasspath += sourceSets.main.runtimeClasspath
    }
}

configurations {
    labImplementation.extendsFrom implementation
    labRuntimeOnly.extendsFrom runtimeOnly
}

dependencies {
    implementation project(':core')
    implementation project(':storage')
    implementation project(':values')
    implementation "hu.webarticum.miniconnect:lang:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:lang-jackson:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:api:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:messenger:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:rdbms-framework:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:record:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:server:${miniConnectVersion}"
    implementation "hu.webarticum.miniconnect:util:${miniConnectVersion}"
    
    implementation 'hu.webarticum.strex:strex:1.2.0'
    implementation 'com.github.mifmif:generex:1.0.2'
    implementation 'com.fasterxml.jackson.core:jackson-core:2.13.3'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.3'
    implementation 'com.fasterxml.jackson.core:jackson-annotations:2.13.3'
    implementation 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.13.3'
    implementation 'com.fasterxml.jackson.dataformat:jackson-dataformat-xml:2.13.3'
}

application {
    mainClass = project.ext.mainClass
}

jib {
    to {
        image = 'miniconnect/holodb'
        tags = [version, 'latest']
        auth {
            username = findProperty('dockerHubUsername') ?: ''
            password = findProperty('dockerHubPassword') ?: ''
        }
    }
    container {
        ports = ['3430']
        args = ['/app/config.yaml']
        mainClass = project.ext.mainClass
    }
}
